!function(e,t){"function"==typeof define&&define.amd?define("hijacker",[],t):"object"==typeof exports?module.exports=t():e.Hijacker=t()}(this,function(){function e(e,t,o,n){if(n=n||{},!e||!t||!o||"object"!=typeof o)throw"Missing or invalid Hijacker proxy initialization options";this.name=e,this.condition="function"==typeof t?t:function(e){return t===e},this.callbacks={beforeSend:[],receive:[],complete:[]};var r={text:String,html:function(e){return e},xml:function(e){return e},json:JSON.parse},i=(this.dataParsers=r,n.dataParsers);if(i)for(var s in i)i.hasOwnProperty(s)&&(this.dataParsers[s]=i[s]);for(var a in o)o.hasOwnProperty(a)&&this.callbacks[a].push(o[a]);return this}function t(e){var t={},o={text:"responseText",json:"responseJSON",xml:"responseXML"};for(var n in o)e.hasOwnProperty(o[n])&&(t[n]=e[o[n]]);return t}var o={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4};return e.prototype.getResponseHeader=function(e,t){var n,r,i=/^(.*?):[ \t]*([^\r\n]*)$/gm;if([o.HEADERS_RECEIVED,o.LOADING,o.DONE].indexOf(e.readyState)>-1){if(r=e.getAllResponseHeaders(),!this.responseHeaders)for(this.responseHeaders={};n=i.exec(r);)this.responseHeaders[n[1].toLowerCase()]=n[2];n=this.responseHeaders[t.toLowerCase()]}return null===n?null:n},e.prototype.getResponseHeaderType=function(e){var t=this.getResponseHeader(e,"Content-Type")||"text/html",o={html:/html/,json:/json/,script:/(?:java|ecma)script/};for(var n in o)if(o.hasOwnProperty(n)&&o[n].test(t))return n;return"text"},e.prototype.parseResponse=function(e){var o=this.dataParsers,n=this.getResponseHeaderType(e),r=t(e);return r[n]?r[n]:o[n]?o[n](e.response||e.responseText):e.responseText},e.prototype.fireEvent=function(e,t){var o=this.callbacks[e];if(this.condition(t.url,t))for(var n=0;n<o.length;n++)"complete"===e||"receive"===e?o[n].call(this,this.parseResponse(t),t):o[n].call(this,t)},e.prototype.addListener=function(e,t){this.callbacks[e].push(t)},e.prototype.removeListener=function(e,t){var o;if(!(e in this.callbacks))throw e+" listener does not exist!";if(o=this.callbacks[e],t){var n=o.indexOf(t);if(0>n)throw t+" callback does not exist!";o=o.slice(0,n).concat(o.slice(n+1))}else o=[];this.callbacks[e]=o},e}),function(e,t){"function"==typeof define&&define.amd?define("hijax",["hijacker"],t):"object"==typeof exports?module.exports=t(require("hijacker")):e.hijax=t(e.Hijacker)}(this,function(e){function t(e,t,o){var n=function(){var n;if("function"!=typeof e)throw e+" is not a function, and cannot be proxied!";return"function"==typeof t&&t.apply(this,arguments),n=e.apply(this,arguments),"function"==typeof o&&o.apply(this,arguments),n};return n}function o(e){this.proxies={},this.adapter=e,this.active=0,e?e.init.call(this):this.proxyXHREvents()}return o.prototype.getXHRMethod=function(e){return window.XMLHttpRequest.prototype[e]},o.prototype.setXHRMethod=function(e,t){window.XMLHttpRequest.prototype[e]=t},o.prototype.proxyXhrMethod=function(e,o,n){var r=t(this.getXHRMethod(e),o,n);this.setXHRMethod(e,r)},o.prototype.createProxy=function(t,o,n,r){var i=new e(t,o,n,r);return this.proxies[t]=i,i},o.prototype.set=function(e,t,o,n){return this.createProxy(e,t,o,n)},o.prototype.addListener=function(e,t,o){if(!(e in this.proxies))throw e+" proxy does not exist!";this.proxies[e].addListener(t,o)},o.prototype.removeListener=function(e,t,o){if(!(e in this.proxies))throw e+" proxy does not exist!";this.proxies[e].removeListener(t,o)},o.prototype.dispatch=function(e,t,o){var n=this.proxies;for(var r in n)n.hasOwnProperty(r)&&n[r].fireEvent(e,t);"function"==typeof o&&o()},o.prototype.proxyXHREvents=function(){var e=this;e.proxyXhrMethod("open",function(t,o){this.url=o,this.rscProxied=!1,this.onLoadProxied=!1,e.active++,e.dispatch("beforeSend",this)}),e.proxyXhrMethod("send",function(){function o(e){return e.readyState>=1&&e.readyState<=3}function n(){o(i)||e.dispatch("receive",i)}function r(){o(i)||e.dispatch("complete",i,function(){e.active--})}var i=this;"function"==typeof i.onload?(i._originalOnLoadHandler=i.onload,i.onLoadProxied=!0,i.onload=t(i.onload,n,r)):"function"==typeof i.onreadystatechange?(i._originalRSCHandler=i.onreadystatechange,i.rscProxied=!0,i.onreadystatechange=t(i.onreadystatechange,n,r)):(window.console&&console.warn&&console.warn("Couldn't find desktop handlers. `complete` might fire before desktop handler."),i.onload=t(r,n))})},o});