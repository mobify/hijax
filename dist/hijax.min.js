!function(t,e){"function"==typeof define&&define.amd?define("hijacker",[],e):"object"==typeof exports?module.exports=e():t.Hijacker=e()}(this,function(){function t(t,e,o,n){if(n=n||{},!t||!e||!o||"object"!=typeof o)throw"Missing or invalid Hijacker proxy initialization options";this.name=t,this.condition="function"==typeof e?e:function(t){return e===t},this.callbacks={beforeSend:[],receive:[],complete:[]};var r={text:String,html:function(t){return t},xml:function(t){return t},json:JSON.parse},i=(this.dataParsers=r,n.dataParsers);if(i)for(var s in i)i.hasOwnProperty(s)&&(this.dataParsers[s]=i[s]);for(var a in o)o.hasOwnProperty(a)&&this.callbacks[a].push(o[a]);return this}function e(t){var e={},o={text:"responseText",json:"responseJSON",xml:"responseXML"};for(var n in o)t.hasOwnProperty(o[n])&&(e[n]=t[o[n]]);return e}var o={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4};return t.prototype.getResponseHeader=function(t,e){var n,r,i=/^(.*?):[ \t]*([^\r\n]*)$/gm;if([o.HEADERS_RECEIVED,o.LOADING,o.DONE].indexOf(t.readyState)>-1){r=t.getAllResponseHeaders();for(var s={};n=i.exec(r);)s[n[1].toLowerCase()]=n[2];n=s[e.toLowerCase()]}return null===n?null:n},t.prototype.getResponseHeaderType=function(t){var e=this.getResponseHeader(t,"Content-Type")||"text/html",o={html:/html/,json:/json/,script:/(?:java|ecma)script/};for(var n in o)if(o.hasOwnProperty(n)&&o[n].test(e))return n;return"text"},t.prototype.parseResponse=function(t){var o=this.dataParsers,n=this.getResponseHeaderType(t),r=e(t);return r[n]?r[n]:o[n]?o[n](t.response||t.responseText):t.responseText},t.prototype.fireEvent=function(t,e){var o=this.callbacks[t];if(this.condition(e.url,e))for(var n=0;n<o.length;n++)"complete"===t||"receive"===t?o[n].call(this,this.parseResponse(e),e):o[n].call(this,e)},t.prototype.addListener=function(t,e){this.callbacks[t].push(e)},t.prototype.removeListener=function(t,e){var o;if(!(t in this.callbacks))throw t+" listener does not exist!";if(o=this.callbacks[t],e){var n=o.indexOf(e);if(0>n)throw e+" callback does not exist!";o=o.slice(0,n).concat(o.slice(n+1))}else o=[];this.callbacks[t]=o},t}),function(t,e){"function"==typeof define&&define.amd?define("hijax",["hijacker"],e):"object"==typeof exports?module.exports=e(require("hijacker")):t.hijax=e(t.Hijacker)}(this,function(t){function e(t,e,o){var n=function(){var n;if("function"!=typeof t)throw t+" is not a function, and cannot be proxied!";return"function"==typeof e&&e.apply(this,arguments),n=t.apply(this,arguments),"function"==typeof o&&o.apply(this,arguments),n};return n}function o(t,e){return null===n||e?(this.proxies={},this.adapter=t,this.active=0,e&&this.clearProxiedXHREvents(),t?t.init.call(this):this.proxyXHREvents(),n=this,void 0):n}var n=null,r={};return o.prototype.getXHRMethod=function(t){return window.XMLHttpRequest.prototype[t]},o.prototype.setXHRMethod=function(t,e){window.XMLHttpRequest.prototype[t]=e},o.prototype.proxyXhrMethod=function(t,o,n){var i=this.getXHRMethod(t);/Proxied by Hijax/i.test(i.toString())||(r[t]=i);var s=e(r[t],o,n);this.setXHRMethod(t,s)},o.prototype.createProxy=function(e,o,n,r){var i=new t(e,o,n,r);return this.proxies[e]=i,i},o.prototype.set=function(t,e,o,n){return this.createProxy(t,e,o,n)},o.prototype.addListener=function(t,e,o){if(!(t in this.proxies))throw t+" proxy does not exist!";this.proxies[t].addListener(e,o)},o.prototype.removeListener=function(t,e,o){if(!(t in this.proxies))throw t+" proxy does not exist!";this.proxies[t].removeListener(e,o)},o.prototype.dispatch=function(t,e,o){var n=this.proxies;for(var r in n)n.hasOwnProperty(r)&&n[r].fireEvent(t,e);"function"==typeof o&&o()},o.prototype.clearProxiedXHREvents=function(){for(var t in r)r.hasOwnProperty(t)&&this.setXHRMethod(t,r[t])},o.prototype.proxyXHREvents=function(){var t=this;t.proxyXhrMethod("open",function(e,o){this.url=o,this.rscProxied=!1,this.onLoadProxied=!1,t.active++,t.dispatch("beforeSend",this)}),t.proxyXhrMethod("send",function(){function o(t){return t.readyState>=1&&t.readyState<=3}function n(){o(i)||t.dispatch("receive",i)}function r(){o(i)||t.dispatch("complete",i,function(){t.active--})}var i=this;"function"==typeof i.onload?(i._originalOnLoadHandler=i.onload,i.onLoadProxied=!0,i.onload=e(i.onload,n,r)):"function"==typeof i.onreadystatechange?(i._originalRSCHandler=i.onreadystatechange,i.rscProxied=!0,i.onreadystatechange=e(i.onreadystatechange,n,r)):(window.console&&console.warn&&console.warn("Couldn't find desktop handlers. `complete` might fire before desktop handler."),i.onload=e(r,n))})},o});